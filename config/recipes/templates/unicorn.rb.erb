working_directory "<%= current_path %>"
pid "<%= unicorn_pid %>"
stderr_path "<%= unicorn_log %>"
stdout_path "<%= unicorn_log %>"

listen "/tmp/unicorn.<%= application %>.sock", :backlog => 64
worker_processes <%= unicorn_workers %>
timeout 30

preload_app true

# Fixes unicorn:restart
#before_exec do |server|
#  ENV['BUNDLE_GEMFILE'] = "<%= current_path %>/Gemfile"
#end

before_fork do |server, worker|
  defined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!
end

after_fork do |server, worker|
  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection
end
